<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#228B22">
    <title>Login - FulfillME</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="manifest" href="../manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="../icons/icon-192x192.png">
    <style>
        /* Login page specific styles */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: calc(100vh - 200px);
            padding: 2rem 1rem;
        }
        
        .auth-card {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 2rem;
            width: 100%;
            max-width: 500px;
        }
        
        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .auth-header h2 {
            color: var(--forest-green);
            margin-bottom: 0.5rem;
        }
        
        .auth-header p {
            color: #666;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark-gray);
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--light-gray);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--forest-green);
        }
        
        .form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .remember-me {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .forgot-password {
            color: var(--forest-green);
            text-decoration: none;
            font-weight: 500;
        }
        
        .forgot-password:hover {
            text-decoration: underline;
        }
        
        .btn-login-submit {
            width: 100%;
            padding: 1rem;
            background-color: var(--forest-green);
            color: var(--white);
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .btn-login-submit:hover {
            background-color: #1a6d1a;
        }
        
        .auth-divider {
            display: flex;
            align-items: center;
            margin: 1.5rem 0;
            color: #666;
        }
        
        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .auth-divider span {
            padding: 0 1rem;
        }
        
        .social-login {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .btn-social {
            padding: 0.75rem;
            border: 2px solid var(--light-gray);
            border-radius: var(--radius);
            background-color: var(--white);
            color: var(--dark-gray);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .btn-social:hover {
            border-color: var(--forest-green);
        }
        
        .btn-google {
            border-color: #DB4437;
            color: #DB4437;
        }
        
        .btn-google:hover {
            background-color: #DB4437;
            color: var(--white);
        }
        
        .auth-footer {
            text-align: center;
            padding-top: 1.5rem;
            border-top: 1px solid var(--light-gray);
        }
        
        .auth-footer a {
            color: var(--forest-green);
            text-decoration: none;
            font-weight: 600;
        }
        
        .auth-footer a:hover {
            text-decoration: underline;
        }
        
        .error-message {
            background-color: #ffcccc;
            color: #cc0000;
            padding: 0.75rem;
            border-radius: var(--radius);
            margin-bottom: 1rem;
            display: none;
        }
        
        .success-message {
            background-color: var(--mint-green);
            color: var(--dark-gray);
            padding: 0.75rem;
            border-radius: var(--radius);
            margin-bottom: 1rem;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="navbar">
            <div class="logo-container">
                <div class="logo">
                    <i class="fas fa-leaf"></i>
                    <h1>Fulfill<span>ME</span></h1>
                </div>
                <button class="menu-toggle" aria-label="Menu">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <ul class="nav-links">
                <li><a href="../index.html"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="browse.html"><i class="fas fa-search"></i> Browse Needs</a></li>
                <li><a href="../index.html#how-it-works"><i class="fas fa-play-circle"></i> How It Works</a></li>
                <li><a href="dashboard.html"><i class="fas fa-user-circle"></i> Dashboard</a></li>
                <li><a href="login.html" class="active"><i class="fas fa-sign-in-alt"></i> Login</a></li>
                <li class="auth-buttons">
                    <a href="login.html" class="btn-login">Login</a>
                    <a href="register.html" class="btn-register">Sign Up Free</a>
                </li>
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="auth-container">
        <div class="auth-card">
            <!-- Error/Success Messages -->
            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>
            
            <div class="auth-header">
                <h2>Welcome Back</h2>
                <p>Login to your FulfillME account</p>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email or Phone Number</label>
                    <input type="text" id="loginEmail" required placeholder="you@example.com or 07XXXXXXXX">
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required placeholder="Enter your password">
                </div>
                
                <div class="form-group">
                    <label for="userType">I am a:</label>
                    <select id="userType" required>
                        <option value="">Select role</option>
                        <option value="asker">Asker (I want to post needs)</option>
                        <option value="fulfiller">Fulfiller (I want to fulfill needs)</option>
                    </select>
                </div>
                
                <div class="form-options">
                    <label class="remember-me">
                        <input type="checkbox" id="rememberMe">
                        Remember me
                    </label>
                    <a href="#" class="forgot-password" id="forgotPassword">Forgot password?</a>
                </div>
                
                <button type="submit" class="btn-login-submit">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                
                <div class="auth-divider">
                    <span>or continue with</span>
                </div>
                
                <div class="social-login">
                    <button type="button" class="btn-social btn-google">
                        <i class="fab fa-google"></i> Google
                    </button>
                    <button type="button" class="btn-social">
                        <i class="fas fa-mobile-alt"></i> Phone
                    </button>
                </div>
                
                <div class="auth-footer">
                    <p>Don't have an account? <a href="register.html">Sign up free</a></p>
                </div>
            </form>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <!-- Same as index.html footer -->
        </div>
    </footer>

    <!-- Forgot Password Modal -->
    <div class="modal" id="forgotPasswordModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Reset Password</h3>
                <button class="modal-close" id="closeForgotModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Enter your email address and we'll send you instructions to reset your password.</p>
                <div class="form-group">
                    <label for="resetEmail">Email Address</label>
                    <input type="email" id="resetEmail" placeholder="you@example.com">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="cancelReset">Cancel</button>
                <button class="btn-confirm" id="sendResetLink">
                    <i class="fas fa-paper-plane"></i> Send Reset Link
                </button>
            </div>
        </div>
    </div>

    <script src="../app.js"></script>
    <script>
        class LoginPage {
            constructor() {
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.checkRememberedUser();
                this.setupForgotPassword();
            }
            
            setupEventListeners() {
                const loginForm = document.getElementById('loginForm');
                loginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleLogin();
                });
                
                // Google login
                document.querySelector('.btn-google').addEventListener('click', () => {
                    this.handleGoogleLogin();
                });
                
                // Phone login
                document.querySelectorAll('.btn-social')[1].addEventListener('click', () => {
                    this.handlePhoneLogin();
                });
            }
            
            setupForgotPassword() {
                const forgotBtn = document.getElementById('forgotPassword');
                const modal = document.getElementById('forgotPasswordModal');
                const closeBtn = document.getElementById('closeForgotModal');
                const cancelBtn = document.getElementById('cancelReset');
                const sendBtn = document.getElementById('sendResetLink');
                
                forgotBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    modal.style.display = 'block';
                });
                
                closeBtn.addEventListener('click', () => {
                    modal.style.display = 'none';
                });
                
                cancelBtn.addEventListener('click', () => {
                    modal.style.display = 'none';
                });
                
                sendBtn.addEventListener('click', () => {
                    this.sendResetLink();
                });
                
                // Close modal on outside click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            }
            
            checkRememberedUser() {
                const remembered = localStorage.getItem('fulfillme_remember');
                if (remembered) {
                    const user = JSON.parse(localStorage.getItem('fulfillme_user'));
                    if (user) {
                        document.getElementById('loginEmail').value = user.email || '';
                        document.getElementById('userType').value = user.userType || '';
                        document.getElementById('rememberMe').checked = true;
                    }
                }
            }
            
            handleLogin() {
                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value;
                const userType = document.getElementById('userType').value;
                const rememberMe = document.getElementById('rememberMe').checked;
                
                // Validation
                if (!email || !password || !userType) {
                    this.showError('Please fill in all fields');
                    return;
                }
                
                // Simulate API call
                this.showLoading(true);
                
                // Check if user exists in localStorage
                setTimeout(() => {
                    const users = JSON.parse(localStorage.getItem('fulfillme_users') || '[]');
                    const user = users.find(u => 
                        (u.email === email || u.phone === email) && 
                        u.userType === userType
                    );
                    
                    if (user) {
                        // Successful login
                        this.showSuccess('Login successful! Redirecting...');
                        
                        // Save user session
                        localStorage.setItem('fulfillme_user', JSON.stringify(user));
                        if (rememberMe) {
                            localStorage.setItem('fulfillme_remember', 'true');
                        } else {
                            localStorage.removeItem('fulfillme_remember');
                        }
                        
                        // Update app state
                        if (window.app) {
                            window.app.currentUser = user;
                            window.app.updateUIForUser();
                        }
                        
                        // Redirect to dashboard
                        setTimeout(() => {
                            window.location.href = 'dashboard.html';
                        }, 1000);
                        
                    } else {
                        // Create demo user if none exists
                        if (users.length === 0) {
                            this.createDemoUser(email, password, userType, rememberMe);
                        } else {
                            this.showError('Invalid credentials or user type');
                        }
                    }
                    
                    this.showLoading(false);
                }, 1000);
            }
            
            createDemoUser(email, password, userType, rememberMe) {
                const demoUser = {
                    id: Date.now(),
                    email: email,
                    fullName: email.split('@')[0].replace('.', ' '),
                    phone: '0712345678',
                    location: 'Nairobi',
                    userType: userType,
                    createdAt: new Date().toISOString()
                };
                
                // Save user
                const users = JSON.parse(localStorage.getItem('fulfillme_users') || '[]');
                users.push(demoUser);
                localStorage.setItem('fulfillme_users', JSON.stringify(users));
                
                // Complete login
                this.showSuccess('Demo account created! Redirecting...');
                
                localStorage.setItem('fulfillme_user', JSON.stringify(demoUser));
                if (rememberMe) {
                    localStorage.setItem('fulfillme_remember', 'true');
                }
                
                if (window.app) {
                    window.app.currentUser = demoUser;
                    window.app.updateUIForUser();
                }
                
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 1000);
            }
            
            handleGoogleLogin() {
                this.showError('Google login coming soon!');
            }
            
            handlePhoneLogin() {
                this.showError('Phone login coming soon!');
            }
            
            sendResetLink() {
                const email = document.getElementById('resetEmail').value.trim();
                
                if (!email) {
                    alert('Please enter your email address');
                    return;
                }
                
                // Simulate sending reset link
                document.getElementById('forgotPasswordModal').style.display = 'none';
                this.showSuccess('Password reset link sent to ' + email);
                
                // Clear input
                document.getElementById('resetEmail').value = '';
            }
            
            showError(message) {
                const errorDiv = document.getElementById('errorMessage');
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
                
                // Hide after 5 seconds
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 5000);
            }
            
            showSuccess(message) {
                const successDiv = document.getElementById('successMessage');
                successDiv.textContent = message;
                successDiv.style.display = 'block';
                
                // Hide after 5 seconds
                setTimeout(() => {
                    successDiv.style.display = 'none';
                }, 5000);
            }
            
            showLoading(loading) {
                const submitBtn = document.querySelector('.btn-login-submit');
                if (loading) {
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
                    submitBtn.disabled = true;
                } else {
                    submitBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
                    submitBtn.disabled = false;
                }
            }
        }
        
        // Initialize login page
        const loginPage = new LoginPage();
        window.loginPage = loginPage;
        
        // Add modal styles if not already added
        if (!document.querySelector('style[data-modal]')) {
            const modalStyle = document.createElement('style');
            modalStyle.setAttribute('data-modal', 'true');
            modalStyle.textContent = `
                .modal {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                }
                
                .modal-content {
                    background: var(--white);
                    border-radius: var(--radius);
                    width: 90%;
                    max-width: 500px;
                    max-height: 90vh;
                    overflow-y: auto;
                }
                
                .modal-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 1.5rem;
                    border-bottom: 1px solid var(--light-gray);
                }
                
                .modal-header h3 {
                    margin: 0;
                    color: var(--dark-gray);
                }
                
                .modal-close {
                    background: none;
                    border: none;
                    font-size: 1.5rem;
                    cursor: pointer;
                    color: #666;
                }
                
                .modal-body {
                    padding: 1.5rem;
                }
                
                .modal-footer {
                    display: flex;
                    gap: 1rem;
                    padding: 1.5rem;
                    border-top: 1px solid var(--light-gray);
                }
                
                .btn-cancel {
                    flex: 1;
                    padding: 0.75rem;
                    background-color: var(--light-gray);
                    color: var(--dark-gray);
                    border: none;
                    border-radius: var(--radius);
                    font-weight: 600;
                    cursor: pointer;
                }
                
                .btn-confirm {
                    flex: 2;
                    padding: 0.75rem;
                    background-color: var(--forest-green);
                    color: var(--white);
                    border: none;
                    border-radius: var(--radius);
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 0.5rem;
                }
            `;
            document.head.appendChild(modalStyle);
        }
    </script>
</body>
</html>